<app-navbar></app-navbar>
<div class="container" style="margin-top: 80px;">
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header" style="background-color: #f8f9fa; border-bottom: 1px solid #e9ecef;">
          <h3 class="mb-0 text-secondary">Angular Advanced MCQ Test</h3>
        </div>
        <div class="card-body p-4">
          
          <!-- Test Instructions -->
          <div *ngIf="!testStarted && !testCompleted" class="text-center">
            <div class="alert alert-info">
              <h5 class="alert-heading">Test Instructions</h5>
              <p class="mb-2">• This test contains 50 multiple choice questions</p>
              <p class="mb-2">• Each question has 4 options with only one correct answer</p>
              <p class="mb-2">• You have 30 minutes to complete the test</p>
              <p class="mb-2">• You can navigate between questions using Previous/Next buttons</p>
              <p class="mb-0">• Click "Submit Test" when you're ready to see your results</p>
            </div>
            <button class="btn" style="background-color: #007bff; border-color: #007bff; color: white;" (click)="startTest()">
              Start Test
            </button>
          </div>

          <!-- Test Progress -->
          <div *ngIf="testStarted && !testCompleted" class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="text-secondary mb-0">Question {{ currentQuestionIndex + 1 }} of {{ questions.length }}</h5>
              <div class="d-flex gap-3">
                <span class="badge" [style.background-color]="timeLeft <= 300 ? '#dc3545' : '#28a745'" style="color: white; font-size: 14px;">
                  Time: {{ getFormattedTime() }}
                </span>
                <span class="badge" style="background-color: #17a2b8; color: white;">
                  Answered: {{ getAnsweredCount() }}/{{ questions.length }}
                </span>
              </div>
            </div>
            <div class="progress mb-3">
              <div class="progress-bar" [style.width.%]="getProgressPercentage()"></div>
            </div>
          </div>

          <!-- Question Display -->
          <div *ngIf="testStarted && !testCompleted && currentQuestion">
            <div class="card shadow-sm mb-4">
              <div class="card-body">
                <h6 class="text-primary mb-3">{{ currentQuestion.question }}</h6>
                <div class="form-check mb-2" *ngFor="let option of currentQuestion.options; let i = index">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    [name]="'question' + currentQuestionIndex" 
                    [id]="'q' + currentQuestionIndex + 'o' + i" 
                    [value]="i" 
                    [checked]="userAnswers[currentQuestionIndex] === i"
                    (change)="selectAnswer(i)">
                  <label class="form-check-label" [for]="'q' + currentQuestionIndex + 'o' + i">
                    {{ option }}
                  </label>
                </div>
              </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="d-flex justify-content-between">
              <button 
                class="btn" 
                style="background-color: #6c757d; border-color: #6c757d; color: white;" 
                [disabled]="currentQuestionIndex === 0" 
                (click)="previousQuestion()">
                Previous
              </button>
              
              <div>
                <button 
                  *ngIf="currentQuestionIndex < questions.length - 1"
                  class="btn me-2" 
                  style="background-color: #007bff; border-color: #007bff; color: white;" 
                  (click)="nextQuestion()">
                  Next
                </button>
                <button 
                  class="btn" 
                  style="background-color: #28a745; border-color: #28a745; color: white;" 
                  (click)="submitTest()">
                  Submit Test
                </button>
              </div>
            </div>
          </div>

          <!-- Test Results -->
          <div *ngIf="testCompleted" class="text-center">
            <div *ngIf="timeUp" class="alert alert-warning mb-3">
              <h5 class="alert-heading">Time's Up!</h5>
              <p class="mb-0">The test was automatically submitted when time expired.</p>
            </div>
            <div class="alert" [class]="getResultAlertClass()">
              <h4 class="alert-heading">Test Completed!</h4>
              <h2>{{ score }}/{{ questions.length }}</h2>
              <p class="mb-0">Your Score: {{ getPercentage() }}%</p>
            </div>

            <!-- Detailed Results -->
            <div class="card shadow-sm mt-4">
              <div class="card-header" style="background-color: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                <h5 class="mb-0 text-secondary">Detailed Results</h5>
              </div>
              <div class="card-body">
                <div class="row text-center mb-3">
                  <div class="col-md-3">
                    <h6 class="text-muted">Correct</h6>
                    <h4 style="color: #28a745;">{{ score }}</h4>
                  </div>
                  <div class="col-md-3">
                    <h6 class="text-muted">Incorrect</h6>
                    <h4 style="color: #dc3545;">{{ questions.length - score }}</h4>
                  </div>
                  <div class="col-md-3">
                    <h6 class="text-muted">Percentage</h6>
                    <h4 style="color: #007bff;">{{ getPercentage() }}%</h4>
                  </div>
                  <div class="col-md-3">
                    <h6 class="text-muted">Grade</h6>
                    <h4 [style.color]="getGradeColor()">{{ getGrade() }}</h4>
                  </div>
                </div>
                
                <div class="d-flex justify-content-center gap-2">
                  <button class="btn" style="background-color: #007bff; border-color: #007bff; color: white;" (click)="retakeTest()">
                    Retake Test
                  </button>
                  <button class="btn" style="background-color: #28a745; border-color: #28a745; color: white;" (click)="viewAnswers()">
                    View Answers
                  </button>
                </div>
              </div>
            </div>

            <!-- Answer Review -->
            <div *ngIf="showAnswers" class="card shadow-sm mt-4">
              <div class="card-header" style="background-color: #f8f9fa; border-bottom: 1px solid #e9ecef;">
                <h5 class="mb-0 text-secondary">Answer Review</h5>
              </div>
              <div class="card-body">
                <div *ngFor="let question of questions; let i = index" class="mb-4 border-bottom pb-3">
                  <h6 class="text-primary">{{ i + 1 }}. {{ question.question }}</h6>
                  <p class="mb-1">
                    <strong>Your Answer:</strong> 
                    <span [style.color]="userAnswers[i] === question.correct ? '#28a745' : '#dc3545'">
                      {{ userAnswers[i] !== undefined ? question.options[userAnswers[i]] : 'Not answered' }}
                    </span>
                  </p>
                  <p class="mb-1">
                    <strong>Correct Answer:</strong> 
                    <span style="color: #28a745;">{{ question.options[question.correct] }}</span>
                  </p>
                  <p class="text-muted small mb-0">{{ question.explanation }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="loading" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading questions...</span>
            </div>
            <p class="mt-2 text-muted">Loading test questions...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>